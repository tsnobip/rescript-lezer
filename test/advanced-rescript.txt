# Advanced declarations and switch

open Stdlib.Result

include Stdlib.List

external log: string => unit = "log"

type person<'a> = {name: string, data: 'a}

type color =
  | Red
  | Green

let makePerson = (~name, ~data=?, input) => {
  switch input {
  | Some(value) => Result.Ok(value)
  | None => Result.Error("unknown")
  }
}

makePerson(~name="Ada", ~data=?Some("ok"), ())

==>

Script(OpenStatement(open,ModulePath(ModulePrefix,ModulePathTail(ConstructorName))),IncludeStatement(include,ModulePath(ModulePrefix,ModulePathTail(ConstructorName))),ExternalDeclaration(external,VariableDefinition,":",FunctionType(TypeName,FunctionArrow("=>"),TypeName),"=",ExternalBody(String)),TypeDeclaration(type,TypeBinding(TypeName,TypeParams(TypeAngleLeftNode(CompareOp),TypeParam(TypeParameter(Quote("'"),VariableName)),TypeAngleRightNode(CompareOp)),"=",TypeBody(RecordType("{",RecordTypeField(PropertyDefinition,":",TypeName),",",RecordTypeField(PropertyDefinition,":",TypeParameter(Quote("'"),VariableName)),"}")))),TypeDeclaration(type,TypeBinding(TypeName,"=",TypeBody(SumType("|",VariantConstructor(ConstructorName),"|",VariantConstructor(ConstructorName))))),LetBinding(let,VariableDefinition,"=",ArrowFunction(ParamList("(",ParamItems(LabeledParameterList(LabeledParameter("~",LabelName),",",LabeledParameter("~",LabelName,ParameterDefault("=","?")),",",SimpleParameter(VariableName))),")"),"=>",BlockExpression("{",SwitchExpression(switch,VariableName,"{",SwitchCase("|",Pattern(ConstructorPattern(VariantConstructor(ConstructorName),PatternArguments("(",Pattern(VariableName),")"))),"=>",CallExpression(MemberExpression(ModulePrefix,MemberLeaf(VariantConstructor(ConstructorName))),"(",Argument(VariableName),")")),SwitchCase("|",Pattern(ConstructorPattern(VariantConstructor(ConstructorName))),"=>",CallExpression(MemberExpression(ModulePrefix,MemberLeaf(VariantConstructor(ConstructorName))),"(",Argument(String),")")),"}"),"}"))),CallExpression(VariableName,"(",Argument(LabeledArgument("~",LabelName,"=",ArgumentValue(String))),",",Argument(LabeledArgument("~",LabelName,"=",ArgumentValue("?",CallExpression(ConstructorName,"(",Argument(String),")")))),",",Argument(UnitLiteral(UnitToken)),")"))
